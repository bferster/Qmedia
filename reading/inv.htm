<!DOCTYPE html>
<html>
<head>
 	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>	
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<title>Spelling Inventory</title>
	<meta charset="utf-8">
	<link REL="SHORTCUT ICON" HREF="http://news.virginia.edu/sites/all/themes/uva_today/favicon.ico">
	<style type="text/css">
		body { font-family:Verdana,Geneva,sans-serif;font-size:12px;margin:24px }
	 	.header { 		text-align:center;font-size:24px;white-space:nowrap;			
	 					}			
	 	.grid 	{ 		line-height:150%;font-size:16px;margin:auto;
	 					}
	 	.table 	{ 		border:1px solid #999;border-radius:20px;padding:12px;
	 					box-shadow:4px 4px 16px #ccc;
	 					}
	 	.labels { 		text-align:center;line-height:100%;font-size:12px;width:60px;vertical-align:top;
	 					white-space:normal;	
	 					}
		.is {			border-radius:10px;padding-left:8px;padding-right:8px;padding-top:1px;
						border:1px solid #999;font-size:16px;height;20px;width:60px;
						}
		.row:hover {	background-color:#dee7f1;
						}
	  			


	</style>
</head>
<body>
	<div class='header'>
		<img src="images/cws.jpg" width="200"><br>
		Primary Spelling Inventory
		<br><br>
		<div class="grid" id="gridDiv"></div>
	</div>
<script>	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// INIT
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	var numFeatures;														// Number of feature columns
	var	count=[];															// Possible answers
	
	var psi={
		features: [ 
		"Initial consonant", "Final consonant",	"Short<br>vowel","Digraph", "Blend",
		"Long<br>vowel", "Other<br> vowel", "Inflected ending","Spelled correctly" ]
		}
		
	var words=[ 
		{ word:"fan",   right:["f", "n", "a"					] },
		{ word:"pet",   right:["p", "t", "e"					] }, 
		{ word:"dig",   right:["d", "g", "i"					] },
		{ word:"rob",   right:["r", "b", "o"					] },  
		{ word:"hope",  right:["h", "p", "",  "",  "",  "o-e" 	] }, 
		{ word:"wait",  right:["w", "i", "",  "",  "",  "ai"	] }, 
		{ word:"gum",  	right:["g", "m", "u"					] }, 
		{ word:"sled",  right:["",  "",  "e", "",  "sl", "" 	] }, 
		{ word:"stick", right:["",  "k", "i", "",  "st", "" 	] }, 
		{ word:"shine", right:["",  "n", "", "sh", "",  "i-e" 	] }, 
		]
	
	var data={
		teacher:"Mrs. Smith",
		student:"Jason",
		grade:"2",
		date:"9/14/14",
		points:0,
		type:"psi",
		mat:[],
		}
		
	$(document).ready(function() {											// WHEN LOADED
		var i,j,m;
		numFeatures=window[data.type].features.length;							// Get number of features
		for (i=0;i<words.length;++i) {											// For each word
			m=[];																// Word array
			for (j=0;j<numFeatures;++j) 										// For each feature
				m.push(0)														// Add feature flag
			data.mat.push(m);
		}	
		
		for (i=0;i<numFeatures;++i) {											// For each feature
			count[i]=0;															// No counts
			for (j=0;j<words.length;++j) 										// For each word
				if (words[j].right[i])	++count[i];								// Add to count
			count[numFeatures-1]=words.length;									// Word total
			}
		Draw();																	// Draw inventory
		});

	function Draw() 														// DRAW IT
	{
		var i;
		var str="<table cellspacing='0' class='table' align='center'><tr><td id='info' style='text-align:left'>";			// Table
		str+="Student: "+data.student+"<br>Teacher: "+data.teacher+"<br>Grade: &nbsp; &nbsp;"+data.grade+"<br>Date:  &nbsp; &nbsp; &nbsp;"+data.date;	// Add info
		for (i=0;i<numFeatures;++i) {											// For each feature
			str+="<td style='text-align:center;width:43px;padding-left:27px' id='fd"+i+"'></td>";
			}
		str+="<tr><td colspan='"+(numFeatures+1)+"'><div style='margin-top:4px;width:100%;height:4px;background-color:#ccc'></div><td></tr>";
		str+="<tr><td></td>";
		for (i=0;i<numFeatures;++i) 											// For each feature
			str+="<td class='labels'>"+window[data.type].features[i]+"</td>";	// Draw label
		str+="</tr><tr><td colspan='"+(numFeatures+1)+"'><div style='margin-bottom:4px;width:100%;height:4px;background-color:#ccc'></div><td></tr>";
		for (i=0;i<words.length;++i) {											// For each word
			str+="<tr class='row'><td style='text-align:left'><input class='is' type='text' id='wrd"+i+"'> &nbsp; "+words[i].word+"</td>"; 
			for (j=0;j<numFeatures;++j)											// For each feature
				str+="<td id='a"+i+"-"+j+"'></td>"								// Add column
			str+="</tr>";														// End row
			}
		str+="<tr><td colspan='"+(numFeatures+1)+"'><div style='margin-top:4px;width:100%;height:4px;background-color:#ccc'></div><td></tr>";
		str+="<tr id='totals'></tr>";											// End row
		str+="</table>";														// End table
		$("#gridDiv").html(str);												// Add content
		for (i=0;i<words.length;++i) 											// For each word
			$("#wrd"+i).on("keyup", function() {								// ON CHANGE
					var id=this.id.substr(3);									// Get id
					ScoreWord(id);
					});				
		DrawInfo();															// Draw the info pane
	}
	
	function DrawInfo() 													// DRAW INFO
	{
		var i,j,h,str;
		var h=$("#info").height();												// Set height
		var tot="<td style='text-align:left'>Totals</td>";
	
		for (i=0;i<numFeatures;++i) {											// For each feature
			h=0;
			for (j=0;j<words.length;++j) 										// For each word
				h+=data.mat[j][i];												// Total column
			tot+="<td>"+h+"/"+count[i]+"</td>";									// Show total
			if (count[i])														// Avoid / 0
				h=Math.round(h/count[i]*100);									// Calc height
			var str="<div><div style='height:"+(100-h)+"px;width:16px;background-color:#eee'></div>";
			str+="<div style='height:"+h+"px;width:16px;background-color:#66c5ff'></div></div>";
			$("#fd"+i).html(str);
			}
		$("#totals").html(tot);
		}

	function ScoreWord(num) 												// SCORE WORD
	{
		var i,pat;
		var a=words[num].right;													// Feature answers
		var m=data.mat[num];													// Point a word row in may
		var w=$("#wrd"+num).val().toLowerCase();								// Word
		var yea="<span style='color:#009900'>&#10003</span>";					// Correct				
		var nay="<span style='color:#990000'>x</span>";							// Wrong
		if (a[0]) {																// First cons
			if (w && (w.charAt(0) == a[0]))	$("#a"+num+"-0").html(yea),m[0]=1;					
			else							$("#a"+num+"-0").html(nay),m[0]=0;			
			}
		if (a[1]) {																// Final cons
			if (w && (w.charAt(w.length-1) == a[1]))		$("#a"+num+"-1").html(yea),m[1]=1;		
			else if (w && (w.charAt(w.length-2) == a[1]))	$("#a"+num+"-1").html(yea),m[1]=1;		
			else							$("#a"+num+"-1").html(nay),m[1]=0;			
			}
		if (a[2]) {																// Short vowel
			var pat=new RegExp(".+"+a[2]+".+");									
			if (w && (w.match(pat)))		$("#a"+num+"-2").html(yea),m[2]=1;
			else							$("#a"+num+"-2").html(nay),m[2]=0;
			}
		if (a[3]) {																// Digraph
			var pat=new RegExp(a[3]);
			if (w && (w.match(pat)))		$("#a"+num+"-3").html(yea),m[3]=1;
			else							$("#a"+num+"-3").html(nay),m[3]=0;
			}
		if (a[4]) {																// Blend
			var pat=new RegExp(a[4]);
			if (w && (w.match(pat)))		$("#a"+num+"-4").html(yea),m[4]=1;
			else							$("#a"+num+"-4").html(nay),m[4]=0;
			}
		if (a[5]) {																// Long vowel
			if (a[5].match('-'))												
				pat=new RegExp(".+"+a[5].split("-")[0]+".+["+a[5].split("-")[1]+"]");
			else																
				pat=new RegExp("."+a[5]);									
			if (w && (w.match(pat)))		$("#a"+num+"-5").html(yea),m[5]=1;
			else							$("#a"+num+"-5").html(nay),m[5]=0;
			}
		if (a[6]) {																// Other vowel
			var pat=new RegExp(".+"+a[6]+".+");
			if (w && (w.match(pat)))		$("#a"+num+"-6").html(yea),m[6]=1;
			else							$("#a"+num+"-6").html(nay),m[6]=0;
			}
		if (a[7]) {																// Inflicted
			var pat=new RegExp(".+"+a[7]+".+");
			if (w && (w.match(pat)))		$("#a"+num+"-7").html(yea),m[7]=1;
			else							$("#a"+num+"-7").html(nay),m[7]=0;
			}
		if (w == words[num].word)			$("#a"+num+"-8").html(yea),m[8]=1;
		else								$("#a"+num+"-8").html(nay),m[8]=0;
		DrawInfo();																// Draw the info pane
	}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// HELPERS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	function trace(msg, p1, p2, p3, p4)										// CONSOLE 
	{
		if (p4 != undefined)
			console.log(msg,p1,p2,p3,p4);
		else if (p3 != undefined)
			console.log(msg,p1,p2,p3);
		else if (p2 != undefined)
			console.log(msg,p1,p2);
		else if (p1 != undefined)
			console.log(msg,p1);
		else
			console.log(msg);
	}
	
</script>	
</body>
</html>

